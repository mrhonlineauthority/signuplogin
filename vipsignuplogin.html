<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M.R.H Auth System</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{background:#f3f3f3;display:flex;justify-content:center;align-items:center;min-height:100vh;}
    .container{background:#fff;width:90%;max-width:400px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.15);padding:30px;text-align:center;transition:0.3s;}
    h2{margin-bottom:15px;color:#333;}
    .input-group{position:relative;margin:8px 0;}
    input{width:100%;padding:12px 40px 12px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;}
    .toggle-pass{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;color:#888;}
    button{width:100%;background:#ff4081;color:#fff;padding:12px;border:none;border-radius:8px;font-size:16px;margin-top:10px;cursor:pointer;transition:0.3s;}
    button:hover{background:#e73370;}
    .google-btn, .facebook-btn{background:#fff;color:#444;border:1px solid #ccc;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:10px;padding:10px;border-radius:8px;cursor:pointer;transition:0.3s;}
    .google-btn img, .facebook-btn img{width:22px;}
    .google-btn:hover, .facebook-btn:hover{background:#f0f0f0;}
    .link-text{font-size:14px;color:#555;margin-top:10px;}
    .link-text span{color:#ff4081;cursor:pointer;font-weight:bold;}
    .profile{display:none;}
    .profile i{font-size:60px;color:#ff4081;margin-bottom:15px;}
    .password-info{font-size:12px;color:#555;text-align:left;margin:4px 0;}
    .password-info span{color:#ff4081;}
    @media(max-width:450px){.container{padding:20px;}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Signup Form -->
    <div class="signup">
      <h2>Create Account</h2>
      <input type="text" id="fullname" placeholder="Full Name" required>
      <input type="text" id="username" placeholder="Username" required>
      <input type="email" id="signupEmail" placeholder="Email" required>
      <div class="input-group">
        <input type="password" id="signupPassword" placeholder="Password" required>
        <i class="fa-solid fa-eye toggle-pass" id="toggleSignupPass"></i>
      </div>
      <div class="password-info">
        Password must be 8+ chars, include <span>uppercase</span>, <span>lowercase</span>, <span>number</span> & <span>symbol</span>
      </div>
      <div class="input-group">
        <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
        <i class="fa-solid fa-eye toggle-pass" id="toggleSignupConfirm"></i>
      </div>
      <button id="signupBtn">Sign Up</button>

      <button class="google-btn" id="googleSignup"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">Continue with Google</button>
      <button class="facebook-btn" id="facebookSignup"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png">Continue with Facebook</button>

      <p class="link-text">Already have an account? <span id="toLogin">Login</span></p>
    </div>

    <!-- Login Form -->
    <div class="login" style="display:none;">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required>
      <div class="input-group">
        <input type="password" id="loginPassword" placeholder="Password" required>
        <i class="fa-solid fa-eye toggle-pass" id="toggleLoginPass"></i>
      </div>
      <button id="loginBtn">Login</button>

      <button class="google-btn" id="googleLogin"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">Login with Google</button>
      <button class="facebook-btn" id="facebookLogin"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png">Login with Facebook</button>

      <p class="link-text">Donâ€™t have an account? <span id="toSignup">Sign Up</span></p>
    </div>

    <!-- Profile Page -->
    <div class="profile">
      <i class="fa-solid fa-user-circle"></i>
      <h2 id="welcomeText">Welcome to our system.</h2>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signInWithPopup,
      GoogleAuthProvider,
      FacebookAuthProvider,
      signOut,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    // ðŸ”¹ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB5sGaaPwOM1WoySpZUqfcUEnDTGWHla58",
      authDomain: "mrhlogin-2cd54.firebaseapp.com",
      projectId: "mrhlogin-2cd54",
      storageBucket: "mrhlogin-2cd54.firebasestorage.app",
      messagingSenderId: "372410485178",
      appId: "1:372410485178:web:8485563e94a740147bb583"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();
    const fbProvider = new FacebookAuthProvider();

    // UI Elements
    const signupBox = document.querySelector('.signup');
    const loginBox = document.querySelector('.login');
    const profileBox = document.querySelector('.profile');

    const toLogin = document.getElementById('toLogin');
    const toSignup = document.getElementById('toSignup');
    const signupBtn = document.getElementById('signupBtn');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const googleSignup = document.getElementById('googleSignup');
    const googleLogin = document.getElementById('googleLogin');
    const facebookSignup = document.getElementById('facebookSignup');
    const facebookLogin = document.getElementById('facebookLogin');
    const welcomeText = document.getElementById('welcomeText');

    const toggleSignupPass = document.getElementById('toggleSignupPass');
    const toggleSignupConfirm = document.getElementById('toggleSignupConfirm');
    const toggleLoginPass = document.getElementById('toggleLoginPass');

    // Toggle Password Visibility
    toggleSignupPass.onclick = ()=>{ const p=document.getElementById('signupPassword'); p.type = p.type==='password'?'text':'password'; }
    toggleSignupConfirm.onclick = ()=>{ const p=document.getElementById('confirmPassword'); p.type = p.type==='password'?'text':'password'; }
    toggleLoginPass.onclick = ()=>{ const p=document.getElementById('loginPassword'); p.type = p.type==='password'?'text':'password'; }

    // Switch forms
    toLogin.onclick = ()=>{ signupBox.style.display='none'; loginBox.style.display='block'; }
    toSignup.onclick = ()=>{ loginBox.style.display='none'; signupBox.style.display='block'; }

    // Password validation
    function isStrongPassword(p){
      return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/.test(p);
    }

    // Check password uniqueness
    async function isUniquePassword(p){
      const q = query(collection(db,"passwords"), where("pass","==",p));
      const snap = await getDocs(q);
      return snap.empty;
    }

    // Save password hash to Firestore
    async function savePassword(p){
      await addDoc(collection(db,"passwords"), {pass:p});
    }

    // Signup Email/Password
    signupBtn.onclick = async ()=>{
      const name = document.getElementById('fullname').value.trim();
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('signupEmail').value;
      const pass = document.getElementById('signupPassword').value;
      const confirm = document.getElementById('confirmPassword').value;

      if(pass !== confirm){ alert("Passwords do not match!"); return; }
      if(!isStrongPassword(pass)){ alert("Password is not strong enough!"); return; }
      if(!(await isUniquePassword(pass))){ alert("Password already used by another user!"); return; }

      try{
        const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(userCredential.user, { displayName: name || username });
        await savePassword(pass);
        alert("Account created successfully!");
      }catch(err){
        alert(err.message);
      }
    }

    // Login Email/Password
    loginBtn.onclick = async ()=>{
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPassword').value;
      try{
        await signInWithEmailAndPassword(auth, email, pass);
      }catch(err){
        alert(err.message);
      }
    }

    // Google SignUp/Login
    googleSignup.onclick = async ()=>{ await signInWithPopup(auth, googleProvider); }
    googleLogin.onclick = async ()=>{ await signInWithPopup(auth, googleProvider); }

    // Facebook SignUp/Login
    facebookSignup.onclick = async ()=>{ await signInWithPopup(auth, fbProvider); }
    facebookLogin.onclick = async ()=>{ await signInWithPopup(auth, fbProvider); }

    // Logout
    logoutBtn.onclick = ()=>{ signOut(auth); }

    // Auth State
    onAuthStateChanged(auth, (user)=>{
      if(user){
        signupBox.style.display='none';
        loginBox.style.display='none';
        profileBox.style.display='block';
        welcomeText.innerText = `Welcome to our system, ${user.displayName || "User"}!`;
      }else{
        signupBox.style.display='block';
        loginBox.style.display='none';
        profileBox.style.display='none';
      }
    });

  </script>
</body>
</html>
