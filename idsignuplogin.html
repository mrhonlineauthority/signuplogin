<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M.R.H Registration Authority</title>
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body { 
    font-family: Arial, sans-serif; 
    background: linear-gradient(to bottom, #ffe6f0, #fff0f5);
    margin: 0; padding: 0; 
  }

  .container { 
    max-width: 500px; 
    margin: 50px auto; 
    background: #fff; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    position: relative; /* for helpline button */
  }

  h1 { text-align: center; color: #ff3399; margin-bottom: 10px; }
  h2 { text-align: center; color: #ff66b3; margin-bottom: 25px; }

  input, select { 
    width: 100%; 
    padding: 12px; 
    margin: 8px 0 18px 0; 
    border-radius: 8px; 
    border: 1px solid #ccc; 
    box-sizing: border-box;
    font-size: 15px;
  }

  button { 
    width: 100%; 
    padding: 14px; 
    background: #ff3399; 
    color: #fff; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-size: 16px;
    transition: 0.3s;
  }
  button:hover { background: #ff66b3; }

  .link { text-align: center; margin-top: 18px; color: red; cursor: pointer; font-weight: bold; }

  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px; 
    table-layout: fixed; 
    word-wrap: break-word;
  }
  th, td { 
    border: 1px solid #ccc; 
    padding: 12px; 
    text-align: left; 
    font-size: 14px;
  }
  th { background-color: #ffe6f0; color: #ff3399; }

  /* Helpline button */
  .helpline-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #ff3399;
    color: #fff;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: 0.3s;
  }
  .helpline-btn:hover { background: #ff66b3; }

  @media (max-width: 600px) {
    .container { padding: 20px; margin: 30px 10px; }
    input, select, button { padding: 10px; font-size: 14px; }
    th, td { padding: 10px; font-size: 13px; }
    .helpline-btn { top: 10px; right: 10px; font-size: 16px; width: 40px; height: 40px; }
  }
</style>
</head>
<body>

<!-- Signup Page -->
<div class="container" id="signupPage">
  <button class="helpline-btn" onclick="openHelpline()"><i class="fas fa-headset"></i></button>
  <h1>M.R.H Registration Authority</h1>
  <h2>Signup Now</h2>
  <input type="text" id="fullName" placeholder="Full Name">
  <input type="text" id="idNo" placeholder="ID No">
  <input type="date" id="dob" placeholder="Date of Birth">
  <select id="gender">
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>
  <input type="text" id="phone" placeholder="Phone Number">
  <input type="email" id="email" placeholder="Email">
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <input type="password" id="confirmPassword" placeholder="Confirm Password">
  <button onclick="signup()">Submit</button>
  <div class="link" onclick="showLogin()">Login Page</div>
</div>

<!-- Login Page -->
<div class="container" id="loginPage" style="display:none;">
  <button class="helpline-btn" onclick="openHelpline()"><i class="fas fa-headset"></i></button>
  <h1>M.R.H Registration Authority</h1>
  <h2>Login Now</h2>
  <input type="text" id="loginUsername" placeholder="Username">
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Submit</button>
  <div class="link" onclick="showSignup()">Signup Page</div>
</div>

<!-- User Info Page -->
<div class="container" id="userPage" style="display:none;">
  <button class="helpline-btn" onclick="openHelpline()"><i class="fas fa-headset"></i></button>
  <h1>M.R.H Registration Authority</h1>
  <h2>User Information</h2>
  <table id="userInfoTable">
    <tbody></tbody>
  </table>
  <button onclick="logout()">Logout</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC9ox4Vi5WhXzaTh8i0oKuM6xKLtt3feKU",
    authDomain: "mrh-registration-94156.firebaseapp.com",
    databaseURL: "https://mrh-registration-94156-default-rtdb.firebaseio.com/",
    projectId: "mrh-registration-94156",
    storageBucket: "mrh-registration-94156.firebasestorage.app",
    messagingSenderId: "1054623307007",
    appId: "1:1054623307007:web:d88da72217b672518f68ca"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const signupPage = document.getElementById('signupPage');
  const loginPage = document.getElementById('loginPage');
  const userPage = document.getElementById('userPage');

  window.showLogin = function() {
    signupPage.style.display = 'none';
    loginPage.style.display = 'block';
    userPage.style.display = 'none';
  }

  window.showSignup = function() {
    signupPage.style.display = 'block';
    loginPage.style.display = 'none';
    userPage.style.display = 'none';
  }

  window.logout = function() { showSignup(); }

  window.openHelpline = function() {
    window.open('https://mrhonlineauthority.github.io/mrhhelplinehome', '_blank');
  }

  window.signup = function() {
    const fullName = document.getElementById('fullName').value;
    const idNo = document.getElementById('idNo').value;
    const dob = document.getElementById('dob').value;
    const gender = document.getElementById('gender').value;
    const phone = document.getElementById('phone').value;
    const email = document.getElementById('email').value;
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (!fullName || !idNo || !dob || !gender || !phone || !email || !username || !password) {
      alert("All fields are required");
      return;
    }
    if (password !== confirmPassword) {
      alert("Passwords do not match");
      return;
    }

    set(ref(db, 'users/' + username), { fullName, idNo, dob, gender, phone, email, username, password })
      .then(() => { alert("Signup successful"); showLogin(); })
      .catch((error) => { alert(error); });
  }

  window.login = function() {
    const username = document.getElementById('loginUsername').value;
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if (!username || !email || !password) { alert("All fields are required"); return; }

    const dbRef = ref(db);
    get(child(dbRef, 'users/' + username)).then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        if (data.email === email && data.password === password) {
          showUserPage(data);
        } else { alert("Incorrect Email or Password"); }
      } else { alert("User not found"); }
    }).catch((error) => { alert(error); });
  }

  function showUserPage(data) {
    signupPage.style.display = 'none';
    loginPage.style.display = 'none';
    userPage.style.display = 'block';

    const tbody = document.getElementById('userInfoTable').querySelector('tbody');
    tbody.innerHTML = `
      <tr><th>Full Name</th><td>${data.fullName}</td></tr>
      <tr><th>ID No</th><td>${data.idNo}</td></tr>
      <tr><th>Date of Birth</th><td>${data.dob}</td></tr>
      <tr><th>Gender</th><td>${data.gender}</td></tr>
      <tr><th>Phone</th><td>${data.phone}</td></tr>
      <tr><th>Email</th><td>${data.email}</td></tr>
      <tr><th>Username</th><td>${data.username}</td></tr>
    `;
  }
</script>
</body>
</html>
